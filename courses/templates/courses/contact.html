{% extends 'courses/base.html' %}
{% load static %}

{% block title %}Contact ¬∑ Fluss Deutsch{% endblock %}

{% block content %}

<!-- HEADER -->
<div class="text-center mb-12">
  <h1 class="text-4xl md:text-5xl font-bold">Contact Us</h1>
  <p class="mt-4 text-lg text-gray-600 max-w-2xl mx-auto">
    Have any questions? We're here to help.
  </p>
</div>

<div class="grid md:grid-cols-2 gap-12">

  <!-- CONTACT FORM -->
  <div>
    <div class="border bg-white rounded-xl shadow p-6">
      <h2 class="text-2xl font-semibold mb-2">Send us a Message</h2>
      <p class="text-gray-600 mb-6">
        Fill out the form and our team will get back to you within 24 hours.
      </p>

      <form method="POST" id="contactForm" class="space-y-6" novalidate>
        {% csrf_token %}

        <!-- NAME -->
        <div>
          <label class="block font-medium mb-1">Full Name</label>
          <input 
            type="text" 
            name="name"
            id="name"
            class="w-full border rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-500"
            placeholder="Your Name"
            required
          >
          <p class="text-red-500 text-sm mt-1 hidden" id="nameError">
            Name must be at least 2 characters.
          </p>
        </div>

        <!-- EMAIL -->
        <div>
          <label class="block font-medium mb-1">Email</label>
          <input 
            type="email" 
            name="email"
            id="email"
            class="w-full border rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-500"
            placeholder="you@example.com"
            required
          >
          <p class="text-red-500 text-sm mt-1 hidden" id="emailError">
            Please enter a valid email.
          </p>
        </div>

        <!-- SUBJECT -->
        <div>
          <label class="block font-medium mb-1">Subject</label>
          <input 
            type="text" 
            name="subject"
            id="subject"
            class="w-full border rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-500"
            placeholder="Course Inquiry"
            required
          >
          <p class="text-red-500 text-sm mt-1 hidden" id="subjectError">
            Subject must be at least 5 characters.
          </p>
        </div>

        <!-- MESSAGE -->
        <div>
          <label class="block font-medium mb-1">Message</label>
          <textarea 
            name="message"
            id="message"
            rows="5"
            class="w-full border rounded-md px-3 py-2 focus:ring-2 focus:ring-indigo-500"
            placeholder="Write your message..."
            required
          ></textarea>
          <p class="text-red-500 text-sm mt-1 hidden" id="messageError">
            Message must be at least 10 characters.
          </p>
        </div>

        <!-- SUBMIT -->
        <button 
          id="submitBtn"
          class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-medium rounded-md py-3 transition flex justify-center items-center"
        >
          <span id="btnText">Send Message</span>
          <span 
            id="loader" 
            class="ml-2 hidden animate-spin border-2 border-white border-t-transparent rounded-full w-4 h-4"
          ></span>
        </button>

      </form>
    </div>
  </div>

  <!-- CONTACT INFO + MAP -->
  <div class="space-y-8">

    <div class="space-y-4">
      <h3 class="text-2xl font-semibold">Contact Information</h3>

      <div class="space-y-2 text-gray-600">
        <p class="flex items-center gap-2">üìß <span>support@flussdeutsch.com</span></p>
        <p class="flex items-center gap-2">üìû <span>+49 30 12345678</span></p>
        <p class="flex items-center gap-2">üìç <span>Berlin, Germany</span></p>
      </div>
    </div>

    <div class="relative w-full h-80 rounded-lg overflow-hidden shadow-lg">
      <img 
        src="{% static 'courses/images/map-placeholder.jpg' %}"
        class="object-cover w-full h-full"
        alt="Map placeholder"
      >
    </div>

  </div>
</div>

<!-- TOAST + JS VALIDATION -->
<script>
  const form = document.getElementById("contactForm");
  const submitBtn = document.getElementById("submitBtn");
  const loader = document.getElementById("loader");
  const btnText = document.getElementById("btnText");

  function showToast(message) {
    const toast = document.createElement("div");
    toast.className = "fixed bottom-6 right-6 bg-black text-white px-4 py-3 rounded-lg shadow-lg";
    toast.innerText = message;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
  }

  form.addEventListener("submit", function (e) {
    e.preventDefault();

    const name = document.getElementById("name");
    const email = document.getElementById("email");
    const subject = document.getElementById("subject");
    const message = document.getElementById("message");

    const nameError = document.getElementById("nameError");
    const emailError = document.getElementById("emailError");
    const subjectError = document.getElementById("subjectError");
    const messageError = document.getElementById("messageError");

    let valid = true;

    // VALIDATION RULES
    if (name.value.trim().length < 2) { nameError.classList.remove("hidden"); valid = false; }
    else nameError.classList.add("hidden");

    const emailRegex = /\S+@\S+\.\S+/;
    if (!emailRegex.test(email.value)) { emailError.classList.remove("hidden"); valid = false; }
    else emailError.classList.add("hidden");

    if (subject.value.trim().length < 5) { subjectError.classList.remove("hidden"); valid = false; }
    else subjectError.classList.add("hidden");

    if (message.value.trim().length < 10) { messageError.classList.remove("hidden"); valid = false; }
    else messageError.classList.add("hidden");

    if (!valid) return;

    // SUBMIT LOADING UI
    btnText.textContent = "Sending...";
    loader.classList.remove("hidden");
    submitBtn.disabled = true;

    // SIMULATE API SUCCESS
    setTimeout(() => {
      showToast("Message Sent! Thank you for contacting us.");
      form.reset();
      btnText.textContent = "Send Message";
      loader.classList.add("hidden");
      submitBtn.disabled = false;
    }, 1500);
  });
</script>

{% endblock %}
