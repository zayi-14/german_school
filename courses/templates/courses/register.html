{% extends 'courses/base.html' %}
{% load static %}

{% block title %}Register · Fluss Deutsch{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center py-12 px-4">

  <div class="w-full max-w-2xl bg-white rounded-2xl shadow-xl overflow-hidden">

    <div class="md:flex">

      <!-- LEFT PANEL -->
      <div class="hidden md:block md:w-1/2 bg-gradient-to-br from-indigo-600 to-indigo-400 p-8">
        <div class="h-full flex flex-col justify-center text-white">
          <img src="{% static 'courses/images/german_logo_1.png' %}"
               class="w-28 h-28 rounded-full mb-6 shadow-lg">

          <h2 class="text-2xl font-extrabold mb-2">Welcome to Fluss Deutsch</h2>
          <p class="text-sm text-indigo-100/90">
            Create an account and start learning German — structured CEFR courses and live classes.
          </p>
        </div>
      </div>

      <!-- RIGHT PANEL (FORM) -->
      <div class="w-full md:w-1/2 p-8">

        <div class="mb-6 text-center">
          <h3 class="text-xl font-bold text-slate-700">Create your account</h3>
          <p class="text-sm text-slate-500">Two quick steps to get started</p>
        </div>

        <form id="registerForm" method="post" novalidate>
          {% csrf_token %}

          <!-- STEP INDICATORS -->
          <div class="flex items-center gap-3 mb-6 justify-center">
            <div id="step1Dot"
                 class="w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center font-semibold">
              1
            </div>
            <div class="w-16 h-0 border-t border-gray-200"></div>
            <div id="step2Dot"
                 class="w-8 h-8 rounded-full bg-gray-200 text-slate-500 flex items-center justify-center font-semibold">
              2
            </div>
          </div>

          <!-- STEP 1 -->
          <div id="step1">
            <div class="space-y-4">
              <!-- Name -->
              <div>
                <label class="block text-sm font-medium text-slate-700">Full name</label>
                <input id="full_name" name="full_name" type="text"
                       class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-200"
                       placeholder="John Doe" required>
                <p id="errName" class="mt-1 text-xs text-red-600 hidden"></p>
              </div>

              <!-- Email -->
              <div>
                <label class="block text-sm font-medium text-slate-700">Email</label>
                <input id="email" name="email" type="email"
                       class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-200"
                       placeholder="you@example.com" required>
                <p id="errEmail" class="mt-1 text-xs text-red-600 hidden"></p>
              </div>

              <!-- Phone -->
              <div>
                <label class="block text-sm font-medium text-slate-700">Phone</label>
                <input id="phone" name="phone" type="tel"
                       class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-200"
                       placeholder="+91 98765 43210" required>
                <p id="errPhone" class="mt-1 text-xs text-red-600 hidden"></p>
              </div>
            </div>

            <div class="mt-6 flex justify-end">
              <button type="button" id="toStep2"
                      class="px-5 py-2 rounded-lg bg-indigo-600 text-white font-medium hover:bg-indigo-700">
                Next →
              </button>
            </div>
          </div>

          <!-- STEP 2 -->
          <div id="step2" class="hidden">
            <div class="space-y-4">

              <!-- Username -->
              <div>
                <label class="block text-sm font-medium text-slate-700">Username</label>
                <input id="username" name="username" type="text"
                       class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-200"
                       placeholder="choose a username" required>
                <p id="errUser" class="mt-1 text-xs text-red-600 hidden"></p>
              </div>

              <!-- Password -->
              <div>
                <label class="block text-sm font-medium text-slate-700">Password</label>
                <input id="password" name="password" type="password"
                       class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-200"
                       placeholder="Enter a secure password" required>
                <p id="errPass" class="mt-1 text-xs text-red-600 hidden"></p>
              </div>

              <!-- Confirm Password -->
              <div>
                <label class="block text-sm font-medium text-slate-700">Confirm Password</label>
                <input id="confirm_password" name="confirm_password" type="password"
                       class="mt-1 w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-indigo-200"
                       placeholder="Repeat password" required>
                <p id="errConfirm" class="mt-1 text-xs text-red-600 hidden"></p>
              </div>

              <!-- Optional course -->
              <div>
                <label class="block text-sm font-medium text-slate-700">Select a course (optional)</label>
                <select id="course" name="course"
                        class="mt-1 w-full px-3 py-2 border rounded-lg">
                  <option value="">— No course —</option>
                  {% for c in courses %}
                    <option value="{{ c.id }}">{{ c.title }} ({{ c.level }})</option>
                  {% endfor %}
                </select>
              </div>

            </div>

            <div class="mt-6 flex items-center justify-between">
              <button type="button" id="backStep1" class="px-4 py-2 rounded-lg border"> ← Back</button>

              <button type="submit" id="submitBtn"
                      class="px-5 py-2 rounded-lg bg-indigo-600 text-white font-medium flex items-center gap-2">
                <span id="submitText">Finish & Register</span>
                <svg id="spinner" class="hidden w-4 h-4 animate-spin" viewBox="0 0 24 24">
                  <circle class="opacity-25" cx="12" cy="12" r="10"
                          stroke="white" stroke-width="3" fill="none"></circle>
                  <path class="opacity-75" fill="white"
                        d="M4 12a8 8 0 018-8v4l3-3-3-3v4a8 8 0 018 8z">
                  </path>
                </svg>
              </button>
            </div>
          </div>
        </form>

        <p class="mt-4 text-center text-xs text-slate-500">We will never share your data.</p>
      </div>
    </div>

  </div>
</div>

<!-- JS -->
<script>
  // STEP LOGIC, VALIDATION — YOUR ORIGINAL JS KEPT SAME
  // (Your JS was correct, I only fixed indentation & minor safety.)
  
  const step1 = document.getElementById('step1');
  const step2 = document.getElementById('step2');

  const toStep2Btn = document.getElementById('toStep2');
  const backStep1Btn = document.getElementById('backStep1');

  const step1Dot = document.getElementById('step1Dot');
  const step2Dot = document.getElementById('step2Dot');

  const full_name = document.getElementById('full_name');
  const email = document.getElementById('email');
  const phone = document.getElementById('phone');

  const username = document.getElementById('username');
  const password = document.getElementById('password');
  const confirm_password = document.getElementById('confirm_password');

  // Error elements
  const errName = document.getElementById('errName');
  const errEmail = document.getElementById('errEmail');
  const errPhone = document.getElementById('errPhone');
  const errUser = document.getElementById('errUser');
  const errPass = document.getElementById('errPass');
  const errConfirm = document.getElementById('errConfirm');

  const submitBtn = document.getElementById('submitBtn');
  const submitText = document.getElementById('submitText');
  const spinner = document.getElementById('spinner');

  function validEmail(v){ return /^\S+@\S+\.\S+$/.test(v); }
  function validPhone(v){ return v.trim().length >= 8; }

  function validateStep1(){
    let ok = true;
    if(full_name.value.trim().length < 2){ errName.textContent = "Enter a valid name"; errName.classList.remove("hidden"); ok = false; }
    else errName.classList.add("hidden");

    if(!validEmail(email.value)){ errEmail.textContent = "Enter a valid email"; errEmail.classList.remove("hidden"); ok = false; }
    else errEmail.classList.add("hidden");

    if(!validPhone(phone.value)){ errPhone.textContent = "Enter a valid phone"; errPhone.classList.remove("hidden"); ok = false; }
    else errPhone.classList.add("hidden");

    return ok;
  }

  toStep2Btn.onclick = () => {
    if(!validateStep1()) return;
    step1.classList.add("hidden"); step2.classList.remove("hidden");
    step1Dot.className = "w-8 h-8 rounded-full bg-gray-200 text-slate-500 flex items-center justify-center font-semibold";
    step2Dot.className = "w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center font-semibold";
  };

  backStep1Btn.onclick = () => {
    step2.classList.add("hidden"); step1.classList.remove("hidden");
    step2Dot.className = "w-8 h-8 rounded-full bg-gray-200 text-slate-500 flex items-center justify-center font-semibold";
    step1Dot.className = "w-8 h-8 rounded-full bg-indigo-600 text-white flex items-center justify-center font-semibold";
  };

  // Final validation
  document.getElementById("registerForm").addEventListener("submit", function(e){
    let ok = true;

    if(username.value.trim().length < 3){ errUser.textContent = "Username too short"; errUser.classList.remove("hidden"); ok=false; }
    else errUser.classList.add("hidden");

    if(password.value.length < 8){ errPass.textContent = "Password must be 8+ chars"; errPass.classList.remove("hidden"); ok=false; }
    else errPass.classList.add("hidden");

    if(password.value !== confirm_password.value){
      errConfirm.textContent = "Passwords do not match"; errConfirm.classList.remove("hidden"); ok=false;
    }
    else errConfirm.classList.add("hidden");

    if(!ok){ e.preventDefault(); return; }

    // Loading UI
    submitText.textContent = "Registering...";
    spinner.classList.remove("hidden");
    submitBtn.disabled = true;
  });
</script>

{% endblock %}
